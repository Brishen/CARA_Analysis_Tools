"""Unit tests generated from Pc3D_Hall_debug_py.txt instrumentation log."""

import unittest
import numpy as np
from DistributedPython.ProbabilityOfCollision.Utils.EquinoctialMatrices import EquinoctialMatrices
from DistributedPython.ProbabilityOfCollision.Utils.conj_bounds_Coppola import conj_bounds_Coppola

class TestPc3DHallDebugData(unittest.TestCase):

    def test_EquinoctialMatrices_Primary(self):
        r1 = np.array([[-984195.04332151],
 [ 393234.20445494],
 [6991223.68223041]])
        v1 = np.array([[4883.696742],
 [5689.086045],
 [ 366.536159]])
        C1 = np.array([[ 4.97654564e+04,  5.78713086e+04,  3.37041032e+03,  1.13727227e+01, -4.32547262e+00, -8.00970548e+01],
 [ 5.78713086e+04,  6.73037764e+04,  3.92654293e+03,  1.32199269e+01, -5.03556072e+00, -9.31498511e+01],
 [ 3.37041032e+03,  3.92654293e+03,  2.46140320e+02,  7.58686583e-01, -3.07784863e-01, -5.43403446e+00],
 [ 1.13727227e+01,  1.32199269e+01,  7.58686583e-01,  2.60818623e-03, -9.80418180e-04, -1.82975167e-02],
 [-4.32547262e+00, -5.03556072e+00, -3.07784863e-01, -9.80418180e-04,  3.89588351e-04,  6.96889233e-03],
 [-8.00970548e+01, -9.31498511e+01, -5.43403446e+00, -1.82975167e-02,  6.96889233e-03,  1.28925332e-01]])
        rem_flag = False

        # Run function
        X, P, E, J, K, Q, QStat, QRaw, QRem, CRem = EquinoctialMatrices(r1.flatten(), v1.flatten(), C1, rem_flag)

        # Verify outputs
        expected_X = np.array([-9.84195043e+02,  3.93234204e+02,  6.99122368e+03,  4.88369674e+00,  5.68908604e+00,  3.66536159e-01])
        np.testing.assert_allclose(X, expected_X, rtol=1e-8, atol=1e-8)
        expected_P = np.array([[ 4.97654564e-02,  5.78713086e-02,  3.37041032e-03,  1.13727227e-05, -4.32547262e-06, -8.00970548e-05],
 [ 5.78713086e-02,  6.73037764e-02,  3.92654293e-03,  1.32199269e-05, -5.03556072e-06, -9.31498511e-05],
 [ 3.37041032e-03,  3.92654293e-03,  2.46140320e-04,  7.58686583e-07, -3.07784863e-07, -5.43403446e-06],
 [ 1.13727227e-05,  1.32199269e-05,  7.58686583e-07,  2.60818623e-09, -9.80418180e-10, -1.82975167e-08],
 [-4.32547262e-06, -5.03556072e-06, -3.07784863e-07, -9.80418180e-10,  3.89588351e-10,  6.96889233e-09],
 [-8.00970548e-05, -9.31498511e-05, -5.43403446e-06, -1.82975167e-08,  6.96889233e-09,  1.28925332e-07]])
        np.testing.assert_allclose(P, expected_P, rtol=1e-8, atol=1e-8)
        expected_E = np.array([ 1.06234857e-03, -1.64039328e-04,  3.36211226e-04, -8.69812135e-01, -7.57308557e-01,  5.51760333e+00])
        np.testing.assert_allclose(E, expected_E, rtol=1e-8, atol=1e-8)
        expected_J = np.array([[ 6.17622172e+05, -5.66455921e+03, -7.31127856e+03,  6.25643231e+03, -2.93585201e+02,  4.59707567e+03],
 [-2.46770358e+05, -7.70845188e+03, -7.45041358e+03,  6.39751700e+02, -6.73561149e+03,  5.35519718e+03],
 [-4.38727545e+06, -5.51713702e+03,  4.34534923e+03,  8.44770199e+02,  3.37527139e+02,  3.45024383e+02],
 [ 1.53235856e+03,  2.79682682e+00, -4.13740390e+00,  4.01266123e+00, -4.24742165e+00,  1.04445716e+00],
 [ 1.78506573e+03,  4.39039210e+00, -3.64205427e+00, -3.17452655e+00,  3.33151383e+00, -4.17311877e-01],
 [ 1.15008128e+02,  5.40561190e+00,  5.09319748e+00, -4.19185353e+00,  4.88314830e+00, -7.41929528e+00]])
        np.testing.assert_allclose(J, expected_J, rtol=1e-8, atol=1e-8)
        expected_K = np.array([[ 6.27108592e-08, -2.50560648e-08, -4.45466218e-07, -2.76015691e-04, -3.21534505e-04, -2.07158094e-05],
 [-7.79492534e-05, -6.86111977e-05,  9.59631434e-05,  1.37784685e-01,  1.40335004e-01, -8.18553143e-02],
 [-5.26878199e-05, -8.27121940e-05, -1.01861402e-04, -1.06711859e-01, -1.45254837e-01, -1.03936296e-01],
 [ 8.86762647e-05, -7.72066649e-05,  1.68261018e-05,  8.03153902e-02, -6.99272059e-02,  1.52396466e-02],
 [ 8.52516135e-05, -7.42249662e-05,  1.61762827e-05, -8.35202332e-02,  7.27175268e-02, -1.58477576e-02],
 [-8.59815176e-05, -1.12389270e-04, -5.77336893e-06, -7.74938998e-02,  8.49165543e-02, -2.85134620e-01]])
        np.testing.assert_allclose(K, expected_K, rtol=1e-8, atol=1e-8)
        expected_Q = np.array([[ 1.30262052e-19, -1.72732657e-17, -1.89483111e-17, -5.62958681e-18,  1.04150536e-17,  1.74325762e-14],
 [-1.72732657e-17,  1.82691452e-13, -1.57604549e-13,  2.74294020e-14,  2.39823584e-14, -2.23940855e-12],
 [-1.89483111e-17, -1.57604549e-13,  2.39903048e-13, -3.49174616e-14, -2.00347955e-14, -2.44566861e-12],
 [-5.62958681e-18,  2.74294020e-14, -3.49174616e-14,  8.23847143e-14, -1.87620673e-14, -8.09294516e-13],
 [ 1.04150536e-17,  2.39823584e-14, -2.00347955e-14, -1.87620673e-14,  4.69716329e-14,  1.45591077e-12],
 [ 1.74325762e-14, -2.23940855e-12, -2.44566861e-12, -8.09294516e-13,  1.45591077e-12,  2.33876898e-09]])
        np.testing.assert_allclose(Q, expected_Q, rtol=1e-8, atol=1e-8)
        expected_CRem = np.array([[ 4.97654564e+04,  5.78713086e+04,  3.37041032e+03,  1.13727227e+01, -4.32547262e+00, -8.00970548e+01],
 [ 5.78713086e+04,  6.73037764e+04,  3.92654293e+03,  1.32199269e+01, -5.03556072e+00, -9.31498511e+01],
 [ 3.37041032e+03,  3.92654293e+03,  2.46140320e+02,  7.58686583e-01, -3.07784863e-01, -5.43403446e+00],
 [ 1.13727227e+01,  1.32199269e+01,  7.58686583e-01,  2.60818623e-03, -9.80418180e-04, -1.82975167e-02],
 [-4.32547262e+00, -5.03556072e+00, -3.07784863e-01, -9.80418180e-04,  3.89588351e-04,  6.96889233e-03],
 [-8.00970548e+01, -9.31498511e+01, -5.43403446e+00, -1.82975167e-02,  6.96889233e-03,  1.28925332e-01]])
        np.testing.assert_allclose(CRem, expected_CRem, rtol=1e-8, atol=1e-8)

    def test_EquinoctialMatrices_Secondary(self):
        r2 = np.array([[-983969.60589655],
 [ 393684.59511742],
 [6991219.29162547]])
        v2 = np.array([[1509.562687],
 [7372.938617],
 [-149.250943]])
        C2 = np.array([[ 4.24686255e+04,  2.06637437e+05, -5.01110893e+03,  3.10460653e+01, -1.20109368e+01, -2.20797585e+02],
 [ 2.06637437e+05,  1.00585472e+06, -2.43487649e+04,  1.51002251e+02, -5.85006354e+01, -1.07475276e+03],
 [-5.01110893e+03, -2.43487649e+04,  6.13127499e+02, -3.66714718e+00,  1.39176996e+00,  2.60145779e+01],
 [ 3.10460653e+01,  1.51002251e+02, -3.66714718e+00,  2.27282623e-02, -8.77825331e-03, -1.61353809e-01],
 [-1.20109368e+01, -5.85006354e+01,  1.39176996e+00, -8.77825331e-03,  3.42880112e-03,  6.25114818e-02],
 [-2.20797585e+02, -1.07475276e+03,  2.60145779e+01, -1.61353809e-01,  6.25114818e-02,  1.14840422e+00]])
        rem_flag = False

        # Run function
        X, P, E, J, K, Q, QStat, QRaw, QRem, CRem = EquinoctialMatrices(r2.flatten(), v2.flatten(), C2, rem_flag)

        # Verify outputs
        expected_X = np.array([-9.83969606e+02,  3.93684595e+02,  6.99121929e+03,  1.50956269e+00,  7.37293862e+00, -1.49250943e-01])
        np.testing.assert_allclose(X, expected_X, rtol=1e-8, atol=1e-8)
        expected_P = np.array([[ 4.24686255e-02,  2.06637437e-01, -5.01110893e-03,  3.10460653e-05, -1.20109368e-05, -2.20797585e-04],
 [ 2.06637437e-01,  1.00585472e+00, -2.43487649e-02,  1.51002251e-04, -5.85006354e-05, -1.07475276e-03],
 [-5.01110893e-03, -2.43487649e-02,  6.13127499e-04, -3.66714718e-06,  1.39176996e-06,  2.60145779e-05],
 [ 3.10460653e-05,  1.51002251e-04, -3.66714718e-06,  2.27282623e-08, -8.77825331e-09, -1.61353809e-07],
 [-1.20109368e-05, -5.85006354e-05,  1.39176996e-06, -8.77825331e-09,  3.42880112e-09,  6.25114818e-08],
 [-2.20797585e-04, -1.07475276e-03,  2.60145779e-05, -1.61353809e-07,  6.25114818e-08,  1.14840422e-06]])
        np.testing.assert_allclose(P, expected_P, rtol=1e-8, atol=1e-8)
        expected_E = np.array([ 1.05358439e-03,  3.82709340e-03, -7.82905340e-03, -1.13725715e+00, -2.29344656e-01,  6.09719699e+00])
        np.testing.assert_allclose(E, expected_E, rtol=1e-8, atol=1e-8)
        expected_J = np.array([[ 6.22617175e+05,  4.68865963e+02, -2.99278631e+03,  6.03721334e+03, -3.81696189e+02,  1.43278763e+03],
 [-2.49108091e+05, -2.84663181e+03, -1.36508022e+04,  1.92389353e+02, -6.91424463e+03,  6.99795733e+03],
 [-4.42376795e+06, -6.85689480e+03,  1.57726201e+03,  8.38865648e+02,  3.35628744e+02, -1.41660169e+02],
 [ 4.77595878e+02,  1.30123219e+00, -1.30816699e+00,  1.31434284e+00, -7.14841933e+00,  1.05290894e+00],
 [ 2.33265244e+03,  7.32926376e+00, -8.96803835e-01, -2.95155244e-01,  1.59083499e+00, -4.21267108e-01],
 [-4.72200564e+01,  1.16253931e+00,  7.41167644e+00, -1.28695061e+00,  6.28566665e+00, -7.48104133e+00]])
        np.testing.assert_allclose(J, expected_J, rtol=1e-8, atol=1e-8)
        expected_K = np.array([[ 6.25238897e-08, -2.50157038e-08, -4.44239559e-07, -8.50818647e-05, -4.15553041e-04,  8.41207102e-06],
 [-2.45631202e-05, -1.68580010e-05,  1.38967434e-04,  5.50032550e-02,  2.56436382e-01, -2.98041731e-02],
 [-2.45353615e-05, -1.37658477e-04, -2.12918420e-05,  8.34207412e-03, -5.28485884e-02, -1.28915086e-01],
 [ 1.58267588e-04, -3.19169904e-05,  2.40724424e-05,  2.58477374e-02, -5.21257697e-03,  3.93143142e-03],
 [ 2.86278119e-05, -5.77321995e-06,  4.35427975e-06, -1.48859267e-01,  3.00196639e-02, -2.26414402e-02],
 [-3.16926228e-05, -1.38204006e-04,  2.82225211e-06, -1.12170844e-01,  1.62337165e-02, -2.85775556e-01]])
        np.testing.assert_allclose(K, expected_K, rtol=1e-8, atol=1e-8)
        expected_Q = np.array([[ 9.87316677e-19, -8.02492265e-17, -1.05623259e-16, -1.23282174e-18,  9.97752932e-17,  1.42217260e-13],
 [-8.02492265e-17,  5.00977258e-13, -3.43636053e-14,  2.25903246e-13, -2.01512819e-13, -1.15038928e-11],
 [-1.05623259e-16, -3.43636053e-14,  6.42675743e-13,  1.02247830e-13, -8.80341868e-14, -1.49627780e-11],
 [-1.23282174e-18,  2.25903246e-13,  1.02247830e-13,  6.12976803e-13, -6.37254979e-13, -8.25609560e-13],
 [ 9.97752932e-17, -2.01512819e-13, -8.80341868e-14, -6.37254979e-13,  1.09789636e-12,  1.54610356e-11],
 [ 1.42217260e-13, -1.15038928e-11, -1.49627780e-11, -8.25609560e-13,  1.54610356e-11,  2.05095665e-08]])
        np.testing.assert_allclose(Q, expected_Q, rtol=1e-8, atol=1e-8)
        expected_CRem = np.array([[ 4.24686255e+04,  2.06637437e+05, -5.01110893e+03,  3.10460653e+01, -1.20109368e+01, -2.20797585e+02],
 [ 2.06637437e+05,  1.00585472e+06, -2.43487649e+04,  1.51002251e+02, -5.85006354e+01, -1.07475276e+03],
 [-5.01110893e+03, -2.43487649e+04,  6.13127499e+02, -3.66714718e+00,  1.39176996e+00,  2.60145779e+01],
 [ 3.10460653e+01,  1.51002251e+02, -3.66714718e+00,  2.27282623e-02, -8.77825331e-03, -1.61353809e-01],
 [-1.20109368e+01, -5.85006354e+01,  1.39176996e+00, -8.77825331e-03,  3.42880112e-03,  6.25114818e-02],
 [-2.20797585e+02, -1.07475276e+03,  2.60145779e+01, -1.61353809e-01,  6.25114818e-02,  1.14840422e+00]])
        np.testing.assert_allclose(CRem, expected_CRem, rtol=1e-8, atol=1e-8)

    def test_conj_bounds_Coppola(self):
        gamma = 1e-16
        HBR = 20.0
        r = np.array([[225.43742496],
 [450.39066248],
 [ -4.39060494]])
        v = np.array([[-3374.134055],
 [ 1683.852572],
 [ -515.787102]])
        C = np.array([[ 9.22340819e+04,  2.64508745e+05, -1.64069861e+03,  4.24187881e+01, -1.63364094e+01, -3.00894640e+02],
 [ 2.64508745e+05,  1.07315849e+06, -2.04222220e+04,  1.64222178e+02, -6.35361961e+01, -1.16790261e+03],
 [-1.64069861e+03, -2.04222220e+04,  8.59267819e+02, -2.90846060e+00,  1.08398509e+00,  2.05805435e+01],
 [ 4.24187881e+01,  1.64222178e+02, -2.90846060e+00,  2.53364485e-02, -9.75867149e-03, -1.79651326e-01],
 [-1.63364094e+01, -6.35361961e+01,  1.08398509e+00, -9.75867149e-03,  3.81838947e-03,  6.94803741e-02],
 [-3.00894640e+02, -1.16790261e+03,  2.05805435e+01, -1.79651326e-01,  6.94803741e-02,  1.27732955e+00]])

        # Run function
        tau0, tau1, tau0_gam1, tau1_gam1 = conj_bounds_Coppola(gamma, HBR, r, v, C, False)

        # Verify outputs
        self.assertAlmostEqual(tau0, -0.34206827616588287, places=8)
        self.assertAlmostEqual(tau1, 0.39044713129877023, places=8)
        self.assertAlmostEqual(tau0_gam1, 0.016921386465249082, places=8)
        self.assertAlmostEqual(tau1_gam1, 0.03145746866763826, places=8)

if __name__ == "__main__":
    unittest.main()
